// Debug version with printf statements
// Copy of hid_report_parser.c with debug output

#include <stdio.h>
#include <stdint.h>
#include <stddef.h>
#include <stdbool.h>
#include <string.h>

// Include the header
#include "hid_report_parser_c.h"

// Copy all the constants and structures from hid_report_parser.c
#define ITEM_LONG 0xFE
#define ITEM_TAG_MASK 0xF0
#define ITEM_TYPE_MASK 0x0C
#define ITEM_SIZE_MASK 0x03
#define ITEM_TAG_AND_TYPE_MASK (ITEM_TAG_MASK | ITEM_TYPE_MASK)

#define ITEM_TYPE_MAIN 0x00
#define ITEM_TYPE_GLOBAL 0x04
#define ITEM_TYPE_LOCAL 0x08

#define ITEM_INPUT 0x80
#define ITEM_OUTPUT 0x90
#define ITEM_FEATURE 0xB0
#define ITEM_COLLECTION 0xA0
#define ITEM_END_COLLECTION 0xC0

#define ITEM_USAGE_PAGE 0x04
#define ITEM_LOGICAL_MIN 0x14
#define ITEM_LOGICAL_MAX 0x24
#define ITEM_REPORT_SIZE 0x74
#define ITEM_REPORT_ID 0x84
#define ITEM_REPORT_COUNT 0x94
#define ITEM_PUSH 0xA4
#define ITEM_POP 0xB4

#define ITEM_USAGE 0x08
#define ITEM_USAGE_MIN 0x18
#define ITEM_USAGE_MAX 0x28

#define FLAG_FIELD_VARIABLE 0x02
#define FLAG_FIELD_RELATIVE 0x01

#define MAX_USAGE_RANGES 16
#define MAX_PUSH_POP_STACK 4

#define PAGE_GENERIC_DESKTOP 0x01
#define PAGE_BUTTON 0x09
#define PAGE_CONSUMER 0x0C

#define USAGE_MOUSE 0x02
#define USAGE_X 0x30
#define USAGE_Y 0x31
#define USAGE_WHEEL 0x38
#define USAGE_CONSUMER_AC_PAN 0x0238

#define COLLECTION_TYPE_APPLICATION 0x01

// Test the parser with debug output
static const uint8_t test_descriptor[] = {
    0x05, 0x01, 0x09, 0x02, 0xA1, 0x01, 0x85, 0x02, 0x09, 0x01, 0xA1, 0x00, 0x05, 0x09, 0x19, 0x01,
    0x29, 0x10, 0x15, 0x00, 0x25, 0x01, 0x95, 0x10, 0x75, 0x01, 0x81, 0x02, 0x05, 0x01, 0x16, 0x01,
    0x80, 0x26, 0xFF, 0x7F, 0x75, 0x10, 0x95, 0x02, 0x09, 0x30, 0x09, 0x31, 0x81, 0x06, 0x15, 0x81,
    0x25, 0x7F, 0x75, 0x08, 0x95, 0x01, 0x09, 0x38, 0x81, 0x06, 0x05, 0x0C, 0x0A, 0x38, 0x02, 0x95,
    0x01, 0x81, 0x06, 0xC0, 0xC0, 0x05, 0x0C, 0x09, 0x01, 0xA1, 0x01, 0x85, 0x03, 0x75, 0x10, 0x95,
    0x02, 0x15, 0x01, 0x26, 0xFF, 0x02, 0x19, 0x01, 0x2A, 0xFF, 0x02, 0x81, 0x00, 0xC0, 0x05, 0x01,
    0x09, 0x80, 0xA1, 0x01, 0x85, 0x04, 0x75, 0x02, 0x95, 0x01, 0x15, 0x01, 0x25, 0x03, 0x09, 0x82,
    0x09, 0x81, 0x09, 0x83, 0x81, 0x60, 0x75, 0x06, 0x81, 0x03, 0xC0, 0x06, 0xBC, 0xFF, 0x09, 0x88,
    0xA1, 0x01, 0x85, 0x08, 0x19, 0x01, 0x29, 0xFF, 0x15, 0x01, 0x26, 0xFF, 0x00, 0x75, 0x08, 0x95,
    0x01, 0x81, 0x00, 0xC0};

int main(void)
{
  hid_report_layout_t layouts[16];
  int layout_count;

  printf("=== C Parser Debug Test ===\n\n");

  memset(layouts, 0, sizeof(layouts));
  layout_count = parse_hid_report_descriptor_layouts(
      test_descriptor,
      sizeof(test_descriptor),
      layouts,
      16);

  printf("\nResult: %d layouts found\n\n", layout_count);

  for (int i = 0; i < layout_count; i++)
  {
    hid_report_layout_t *l = &layouts[i];
    printf("Layout[%d]: report_id=%u, buttons=%u/%u, x=%u/%u, y=%u/%u, wheel=%u/%u, pan=%u/%u, total_bits=%u\n",
           i, l->report_id,
           l->buttons_count, l->buttons_bit_offset,
           l->x_size, l->x_bit_offset,
           l->y_size, l->y_bit_offset,
           l->wheel_size, l->wheel_bit_offset,
           l->pan_size, l->pan_bit_offset,
           l->report_size_bits);
  }

  return 0;
}
